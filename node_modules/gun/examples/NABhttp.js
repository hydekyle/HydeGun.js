var fs = require('fs');
var config = {
	port: process.env.OPENSHIFT_NODEJS_PORT || process.env.VCAP_APP_PORT || process.env.PORT || process.argv[2] || 8765
};
var Gun = require('../'); // require('gun')

if(process.env.HTTPS_KEY){
	config.key = fs.readFileSync(process.env.HTTPS_KEY);
	config.cert = fs.readFileSync(process.env.HTTPS_CERT);
	config.server = require('https').createServer(config, Gun.serve(__dirname));
} else {
	config.server = require('http').createServer(Gun.serve(__dirname));
}

var gun = Gun({
	file: Gun.text.random(3)+'data',
	web: config.server
});


var superPeerCopy = {_:{'#':'~GPXyNtUXUE-uviXo9E1tI68Ccs0AlNRrRp02bo60M2Q.R-KIB2MUp97h8rZHngKJS99dorb544w8BDblM3wbfjI','>':{alias:1535126077984}},
  test: decodeURIComponent("SEA%7B%22m%22%3A%22%5C%22a%24%60b%5C%22%22%2C%22s%22%3A%22%C3%89%7C%C3%93%C3%A0%C3%9F%C3%B1%C2%8C%5Cu0015k%C2%87T%C3%A9%5Cu000e%C3%B7%C2%90%C3%B2%C2%9F%5Ct%C2%9E%5D%5Cu0002%5Cu0001%C3%876(%C2%BD%5Cu0015%5B!X%C3%98%C3%B5%C3%80No%C3%82%5Cu0001%2F%C2%A5%C3%BCD%7D%C3%A4PJ%C2%BF%5C%5Cj%5Cu001b%5Cu000b_%C3%BE%C2%98%C2%95%C2%AA%5Cb%C3%A6%5Cu000f%3B%C3%83%C3%86%5Ct%5Cu001c%C3%98%22%7D")
}
gun._.graph['~GPXyNtUXUE-uviXo9E1tI68Ccs0AlNRrRp02bo60M2Q.R-KIB2MUp97h8rZHngKJS99dorb544w8BDblM3wbfjI'] = superPeerCopy;

config.server.listen(config.port);
console.log('ISOLATED NAB Server started on port ' + config.port + ' with /gun');